<!--This page will return all files and directories of current user by his name-->
@{
    ViewBag.Title = "View Storage";
}

<p id="currentPath">@ViewBag.CurrentPath</p>

<div id="resultTable"></div>

@section scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $("#resultTable").load("@Url.Action("DirectoriesAndFilesSummary","Account", new {path = ViewBag.CurrentPath})");
        });

        function linkToPrevClicked() {
            if ($("#currentPath").text() == "@User.Identity.Name") {

            } else {
                var currentPath = $("#currentPath").text();
                var newPath = currentPath.substring(0, currentPath.lastIndexOf('\\'));
                $("#currentPath").text(newPath);

                //Call Account Controller method and pass a value to it
                $(document).ready(function () {
                    callUrl();
                });
            }
        };

        function onFolderClicked() {
            //Call Account Controller method and pass a value to it
            $(document).ready(function () {
                callUrl();
            });
        };

        function callUrl() {
            $.ajax({
                url: "@Url.Action("DirectoriesAndFilesSummary", "Account")",
                data: { path: $("#currentPath").text() },
                type: "GET",
                success: function (result) {
                    $("#resultTable").html(result);
                }
            });
        }

        $("#uploadFileButton").on("click",
            function(e) {
                e.preventDefault();
                var files = document.getElementById("uploadFile").files;
                if (files.length > 0) {
                    if (window.FormData !== undefined) {
                        var data = new FormData();
                        for (var x = 0; x < files.length; x++) {
                            data.append("file" + x, files[x]);
                        }
                        data.append("path", $("#currentPath").text());

                        $.ajax({
                            type: "POST",
                            url: "@Url.Action("Upload", "Account")",
                            contentType: false,
                            processData: false,
                            //need to pass files and path to Controller method
                            data: data,
                            success: function(result) {
                                alert(result);
                            },
                            error: function(xhr, status, p3) {
                                alert(xhr.reponseText);
                            }
                        });
                    } else {
                        alert("Browser doesn't supports HTML5 files uploading!");
                    }
                }
            });
</script>
}